<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Rilevazione – Cliente 1</title>
<link rel="stylesheet" href="assets/style.css">
</head>
<body class="wrap">
  <h2>Rilevazione Lettura – Cliente 1</h2>
  <p>ID cliente: <b>C001</b></p>

  <label for="lettura">Lettura (kWh)</label>
  <input id="lettura" type="number" step="0.01" min="0" required>

  <label for="pin">Codice segreto</label>
  <input id="pin" type="password" inputmode="numeric" minlength="4" maxlength="8" required>

  <button id="send">Invia</button>
  <div id="msg" role="status" class="alert" style="display:none"></div>

<script>
const FLOW_URL = "https://FLOW_INGEST_URL"; // INCOLLA QUI
function show(type, text){const b=document.getElementById('msg');b.className='alert '+type;b.textContent=text;b.style.display='block'}
document.getElementById('send').onclick = async () => {
  const lettura = parseFloat(document.getElementById('lettura').value);
  const pin = document.getElementById('pin').value.trim();
  if (isNaN(lettura) || !pin){ show('err','Compila lettura e codice.'); return; }
  show('info','Invio in corso…'); document.getElementById('send').disabled = true;
  const payload = { cliente:"C001", lettura, codice:pin, ts:new Date().toISOString() };
  try{
    const r = await fetch(FLOW_URL,{ method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload) });
    let data={}; try{ data = await r.json(); } catch {}
    if(r.status===200 && data.ok){
      show('ok', (data.message||'Lettura registrata.') + (data.energia!=null?` Energia: ${data.energia} kWh.`:'')); 
      document.getElementById('lettura').value=''; document.getElementById('pin').value='';
    } else if (r.status===403){
      show('err', data.message||'Codice segreto errato.');
    } else {
      show('err', data.message||'Errore imprevisto. Riprova.');
    }
  }catch(e){ show('err','Problema di connessione.'); }
  finally { document.getElementById('send').disabled = false; }
};
</script>
</body>
</html>
